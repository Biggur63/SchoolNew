{{/* photomasters shortcode — таблица */}}

{{ $list := .Site.Data.masters }}

{{ if not $list }}
<p class="text-gray-300 text-sm">Нет данных: data/masters.yaml</p>
{{ else }}

{{/* ---- Подготовка списка с сортировкой по фамилии ---- */}}
{{ $prepared := slice }}

{{ range $m := $list }}

  {{ if not $m.name }}{{ continue }}{{ end }}

  {{ $lname := lower $m.name }}
  {{ if or
        (in $lname "имя")
        (in $lname "годы")
        (in $lname "жизни")
        (in $lname "ссылка")
        (in $lname "открыть")
     }}
     {{ continue }}
  {{ end }}

  {{ $words := split $m.name " " }}
  {{ if lt (len $words) 1 }}{{ continue }}{{ end }}
  {{ $last := index $words (sub (len $words) 1) }}

  {{ $item := dict
      "sortkey" (lower $last)
      "name" $m.name
      "name2nd" $m.name2nd
      "born" $m.born
      "died" $m.died
      "link" $m.link
  }}

  {{ $prepared = $prepared | append $item }}

{{ end }}

{{ $sorted := sort $prepared "sortkey" }}


<table class="masters-table min-w-full border-collapse my-0 text-sm bg-gray-900 text-gray-200">
  <thead class="sticky top-0 bg-gray-900 z-30">
    <tr class="border-b border-gray-600">
      <th class="py-2 px-3 font-semibold text-left">№</th>
      <th class="py-2 px-3 font-semibold text-left">Имя</th>
      <th class="py-2 px-3 font-semibold text-left">Годы жизни</th>
      <th class="py-2 px-3 font-semibold text-left">Ссылка</th>
    </tr>
  </thead>

  <tbody class="divide-y divide-gray-700">
    {{ $idx := 0 }}
    {{ range $sorted }}
      {{ $idx = add $idx 1 }}
      <tr>
        <td class="py-2 px-3">{{ $idx }}</td>
        <td class="py-2 px-3">
          {{ .name }}
          {{ with .name2nd }}
            <div class="text-gray-400 text-xs">{{ . }}</div>
          {{ end }}
        </td>
        <td class="py-2 px-3">
          {{ with .born }}{{ . }}{{ end }}
          {{ if and .born .died }} — {{ end }}
          {{ with .died }}{{ . }}{{ end }}
        </td>
        <td class="py-2 px-3">
          {{ with .link }}
            <a href="{{ . }}" class="text-indigo-400 underline hover:text-indigo-300" target="_blank">открыть</a>
          {{ end }}
        </td>
      </tr>
    {{ end }}
  </tbody>
</table>

{{ end }}
