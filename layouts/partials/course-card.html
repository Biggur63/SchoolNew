{{/* layouts/partials/course-card.html
   Универсальная карточка: одинаковое поведение hover/focus
   для scenario A: <article class="course-card"> (courses)
   и scenario B: <a>…<article class="course-card">…</article>…</a> (basic-course),
   включая случаи с дополнительными контейнерами между <a> и .course-card.
*/}}

<article class="course-card relative p-4 rounded border bg-white overflow-hidden transition" aria-labelledby="course-title-{{ .File.UniqueID }}">

  <style>
    /* ========== Базовые стили ========== */
    .course-card {
      transition: border-color 180ms ease;
    }

    .card-inner {
      transition: transform 180ms ease, box-shadow 180ms ease;
      transform: translateY(0);
    }

    .thumb-img {
      transition: transform 180ms ease;
      transform-origin: center;
    }

    .card-title { color: #111827; text-decoration: none !important; }
    .card-summary { color: #374151; text-decoration: none !important; }

    /* ========== Hover / focus (когда сам article получает hover/focus-within) ========== */
    .course-card:hover .card-inner,
    .course-card:focus-within .card-inner {
      transform: translateY(-6px);
      box-shadow:
        0 12px 30px rgba(2,6,23,0.08),
        0 4px 6px rgba(2,6,23,0.04);
    }

    .course-card:hover,
    .course-card:focus-within {
      border-color: rgba(79,70,229,0.25);
    }

    .course-card:hover .thumb-img,
    .course-card:focus-within .thumb-img {
      transform: scale(1.02);
    }

    .course-card:focus-within {
      outline: 3px solid rgba(79,70,229,0.85);
      outline-offset: -3px;
      border-radius: 8px;
    }

    /* ========== Универсальные селекторы: те же эффекты, когда любая ancestor <a> в состоянии hover/focus ==========
       Используем descendant (a:hover .course-card), чтобы покрыть все вложенные структуры. */
    a:hover .course-card .card-inner,
    a:focus .course-card .card-inner,
    a:focus-within .course-card .card-inner {
      transform: translateY(-6px);
      box-shadow:
        0 12px 30px rgba(2,6,23,0.08),
        0 4px 6px rgba(2,6,23,0.04);
    }

    a:hover .course-card,
    a:focus .course-card,
    a:focus-within .course-card {
      border-color: rgba(79,70,229,0.25);
    }

    a:hover .course-card .thumb-img,
    a:focus .course-card .thumb-img,
    a:focus-within .course-card .thumb-img {
      transform: scale(1.02);
    }

    a:focus .course-card,
    a:focus-within .course-card {
      outline: 3px solid rgba(79,70,229,0.85);
      outline-offset: -3px;
      border-radius: 8px;
    }

    /* ========== Убрать подчёркивания, которые внешний <a> может навешивать ========== */
    a:hover .course-card .card-title,
    a:focus .course-card .card-title,
    a:hover .course-card .card-summary,
    a:focus .course-card .card-summary,
    a:hover .course-card *,
    a:focus .course-card * {
      text-decoration: none !important;
    }

    /* на всякий случай убираем ::before/::after декоративные underlines */
    .course-card .card-title::before,
    .course-card .card-title::after,
    .course-card .card-summary::before,
    .course-card .card-summary::after {
      content: none !important;
      text-decoration: none !important;
    }

    /* ========== Stretched link — только для courses ========== */
    {{ if eq .Section "courses" }}
    .course-card .stretched-link {
      position: absolute;
      inset: 0;
      z-index: 10;
      display: block;
      pointer-events: auto;
      text-decoration: none;
      color: inherit;
      background: transparent;
    }
    .course-card .stretched-link:focus-visible {
      outline: 3px solid rgba(79,70,229,0.95);
      outline-offset: -4px;
      border-radius: 8px;
    }
    {{ end }}
  </style>

  <div class="card-inner">

    {{/* Изображение */}}
    {{ if .Resources.GetMatch "thumb*" }}
      {{ $r := .Resources.GetMatch "thumb*" }}
      <div class="w-full h-44 mb-3 rounded overflow-hidden thumb-img">
        <img src="{{ $r.RelPermalink }}" alt="{{ .Title }}" class="w-full h-full object-cover">
      </div>
    {{ else if .Params.thumb }}
      <div class="w-full h-44 mb-3 rounded overflow-hidden thumb-img">
        <img src="{{ .Params.thumb }}" alt="{{ .Title }}" class="w-full h-full object-cover">
      </div>
    {{ else if .Params.image }}
      <div class="w-full h-44 mb-3 rounded overflow-hidden thumb-img">
        <img src="{{ .Params.image }}" alt="{{ .Title }}" class="w-full h-full object-cover">
      </div>
    {{ else if .Params.bg_image }}
      <div class="w-full h-44 mb-3 rounded overflow-hidden thumb-img">
        <img src="{{ .Params.bg_image }}" alt="{{ .Title }}" class="w-full h-full object-cover">
      </div>
    {{ else }}
      <div class="w-full h-44 bg-gray-100 flex items-center justify-center mb-3 text-gray-400 rounded thumb-img">
        Нет изображения
      </div>
    {{ end }}

    {{/* Заголовок */}}
    <h3 class="text-xl font-semibold mb-2 card-title">
      {{ .Title }}
    </h3>

    {{/* Описание */}}
    {{ with .Params.summary }}
      <p class="card-summary mb-3">
        {{ . }}
      </p>
    {{ end }}

    {{/* level — не показываем в courses */}}
    {{ if and .Params.level (ne .Section "courses") }}
      <span class="inline-block text-sm px-2 py-1 rounded bg-gray-100 text-gray-700">
        {{ .Params.level }}
      </span>
    {{ end }}

  </div> <!-- .card-inner -->

  {{/* stretched-link — только для courses */}}
  {{ if eq .Section "courses" }}
    <a
      href="{{ .RelPermalink }}"
      class="stretched-link"
      aria-label="Открыть модуль «{{ .Title }}»">
    </a>
  {{ end }}

</article>
